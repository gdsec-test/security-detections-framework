{"id":"59da9f90-9676-11ec-ab18-0d51419cd75c","updated_at":"2022-03-21T22:28:14.063Z","updated_by":"jprentice1@godaddy.com","created_at":"2022-02-25T20:05:59.966Z","created_by":"admin","name":"Suspicious AWS Secrets Manager Events","tags":["GD","Security"],"interval":"1h","enabled":true,"description":"based on splunk Suspicious AWS Secrets Manager Events rule logic. no hits searching over 7 days of historical data","risk_score":21,"severity":"low","license":"","output_index":".siem-signals-default","meta":{"from":"10m","kibana_siem_app_url":"https://security-prod.kibana.int.gdcorp.tools/app/security"},"author":[],"false_positives":[],"from":"now-4200s","rule_id":"0c18aa92-18b7-4c9f-a86e-ce81f86e424c","max_signals":100,"risk_score_mapping":[],"severity_mapping":[],"threat":[],"to":"now","references":[],"version":13,"exceptions_list":[],"immutable":false,"type":"query","language":"kuery","index":["*:aws-cloudtrail-*"],"query":"NOT (user.name: \"AccountAutomationServiceRole\" OR (user.name: GD-APPSVCS-ESSPInfraRole AND aws.cloudtrail.flattened.request_parameters.secretId: \"essp_apm_deployment\") OR (user.name: GD-APPSVCS-ESSPInfraRole AND aws.cloudtrail.flattened.request_parameters.secretId: \"essp_deployment_credentials\") OR user.name: GD-AWS-IAM-Resources-GDAWSServiceAccountDeployRole-* OR user.name: SC-*-pp-*-LambdaExecutionRole-* OR aws.cloudtrail.user_identity.arn: *GitHubActions)","filters":[{"$state":{"store":"appState"},"meta":{"negate":false,"alias":null,"disabled":false,"type":"phrases","params":["539225272086","763338924548","745293682974"],"key":"cloud.account.id"},"query":{"bool":{"should":[{"match_phrase":{"cloud.account.id":"539225272086"}},{"match_phrase":{"cloud.account.id":"763338924548"}},{"match_phrase":{"cloud.account.id":"745293682974"}}],"minimum_should_match":1}}},{"$state":{"store":"appState"},"meta":{"negate":false,"alias":null,"disabled":false,"type":"phrase","params":{"query":"secretsmanager.amazonaws.com"},"key":"event.provider"},"query":{"match_phrase":{"event.provider":"secretsmanager.amazonaws.com"}}},{"$state":{"store":"appState"},"meta":{"negate":false,"alias":null,"disabled":false,"type":"custom","value":"{\"bool\":{\"should\":[{\"wildcard\":{\"event.action\":{\"value\":\"GetSecretValue*\"}}},{\"wildcard\":{\"event.action\":{\"value\":\"CancelRotateSecret*\"}}},{\"wildcard\":{\"event.action\":{\"value\":\"Create*\"}}},{\"wildcard\":{\"event.action\":{\"value\":\"Delete*\"}}},{\"wildcard\":{\"event.action\":{\"value\":\"Put*\"}}},{\"wildcard\":{\"event.action\":{\"value\":\"Remove*\"}}},{\"wildcard\":{\"event.action\":{\"value\":\"Replicate*\"}}},{\"wildcard\":{\"event.action\":{\"value\":\"Restore*\"}}},{\"wildcard\":{\"event.action\":{\"value\":\"Rotate*\"}}},{\"wildcard\":{\"event.action\":{\"value\":\"StopReplication*\"}}},{\"wildcard\":{\"event.action\":{\"value\":\"Update*\"}}},{\"wildcard\":{\"event.action\":{\"value\":\"Validate*\"}}}],\"minimum_should_match\":1}}","key":"query"},"query":{"bool":{"should":[{"wildcard":{"event.action":{"value":"GetSecretValue*"}}},{"wildcard":{"event.action":{"value":"CancelRotateSecret*"}}},{"wildcard":{"event.action":{"value":"Create*"}}},{"wildcard":{"event.action":{"value":"Delete*"}}},{"wildcard":{"event.action":{"value":"Put*"}}},{"wildcard":{"event.action":{"value":"Remove*"}}},{"wildcard":{"event.action":{"value":"Replicate*"}}},{"wildcard":{"event.action":{"value":"Restore*"}}},{"wildcard":{"event.action":{"value":"Rotate*"}}},{"wildcard":{"event.action":{"value":"StopReplication*"}}},{"wildcard":{"event.action":{"value":"Update*"}}},{"wildcard":{"event.action":{"value":"Validate*"}}}],"minimum_should_match":1}}}],"throttle":"rule","actions":[{"group":"default","id":"56fd1b40-5f85-11ec-9d1e-5b56ec0d9762","params":{"body":"{\n  \"short_description\": \"Suspicious AWS Secrets Manager Events (Storage Account)\",\n  \"assignment_group\": \"OPS-GCSO\",\n  \"category\": \"Unauthorized access\",\n  \"contact_type\": \"siem\",\n  \"description\": \"See following Info: \\nSuspicious AWS Secrets Manager Events (Storage Account)\\n\\n{{#context.alerts}}\\nError Code: {{aws.cloudtrail.error_code}}\\nEnvironment: {{environment}}\\nAccount ID: {{cloud.account.id}}\\nUserType: {{aws.cloudtrail.user_identity.type}}\\nUser/Role: {{user.name}}\\nPrincipal ID: {{user.id}}\\nEvent: {{event.action}}\\nSecretID: {{aws.cloudtrail.flattened.request_parameters.secretId}}\\nsource.address: {{source.address}}\\n{{/context.alerts}}\\n\\nSee Process Here:\\nhttps://confluence.godaddy.com/pages/viewpage.action?pageId=214401496\",\n  \"priority\": \"1\",\n  \"severity\": \"2\",\n  \"state\": \"10\"\n}"},"action_type_id":".webhook"}]}
