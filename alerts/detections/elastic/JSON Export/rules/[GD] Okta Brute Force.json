{"id":"e5c95200-3288-11ec-a2aa-e9d655de077e","updated_at":"2022-03-28T21:41:15.946Z","updated_by":"jprentice1@godaddy.com","created_at":"2021-10-21T16:06:50.024Z","created_by":"admin","name":"[GD] Okta Brute Force","tags":[],"interval":"5m","enabled":true,"description":"To identify a brute force attack through okta auth.\nThe following is the configuration used to create SNOW SIR tickets:\n\n{\n  \"short_description\": \"Elastic Test - Okta - Brute Force\",\n  \"assignment_group\": \"OPS-GCSO\",\n  \"category\": \"Unauthorized access\",\n  \"contact_type\": \"siem\",\n  \"description\": \"\"\"See attached info:\n{{#context.alerts}}\nokta.actor.alternate_id : {{okta.actor.alternate_id}}\n@timestamp : {{signal.original_time}}\nsource.ip  : {{source.ip}}\nuser_agent.original  : {{user_agent.original}}\nAttempts  : {{context.value.condition0}}\nDistinctIPAddresses  : pending addition to Elastic\nDistinctUserAgents : pending addition to Elastic\n{{/context.alerts}}\"\"\",\n  \"priority\": \"5\",\n  \"severity\": \"3\",\n  \"state\": \"10\"\n}","risk_score":21,"severity":"low","license":"","output_index":".siem-signals-default","meta":{"from":"1m","kibana_siem_app_url":"https://security-prod.kibana.int.gdcorp.tools/app/security"},"author":[],"false_positives":[],"from":"now-360s","rule_id":"6af72aeb-10e6-4d24-ad12-9b9c02c2a86b","max_signals":100,"risk_score_mapping":[],"severity_mapping":[],"threat":[{"framework":"MITRE ATT&CK","tactic":{"reference":"https://attack.mitre.org/tactics/TA0006","name":"Credential Access","id":"TA0006"},"technique":[{"reference":"https://attack.mitre.org/techniques/T1110","name":"Brute Force","id":"T1110","subtechnique":[]}]}],"to":"now","references":[],"version":15,"exceptions_list":[],"immutable":false,"type":"threshold","language":"kuery","index":["*:okta-*"],"query":"NOT okta.outcome.result : \"SUCCESS\" AND NOT okta.outcome.result: \"ALLOW\"","filters":[{"$state":{"store":"appState"},"meta":{"negate":true,"alias":null,"disabled":false,"type":"custom","value":"{\"bool\":{\"should\":[{\"match_phrase\":{\"okta.actor.alternate_id\":\"unknown\"}},{\"match_phrase\":{\"okta.actor.alternate_id\":\"system@okta.com\"}},{\"match_phrase\":{\"okta.actor.alternate_id\":\"ADService@godaddy.com\"}}],\"minimum_should_match\":1}}","key":"query"},"query":{"bool":{"should":[{"match_phrase":{"okta.actor.alternate_id":"unknown"}},{"match_phrase":{"okta.actor.alternate_id":"system@okta.com"}},{"match_phrase":{"okta.actor.alternate_id":"ADService@godaddy.com"}}],"minimum_should_match":1}}},{"$state":{"store":"appState"},"meta":{"negate":true,"alias":null,"disabled":false,"type":"custom","value":"{\"bool\":{\"should\":[{\"wildcard\":{\"okta.target.display_name\":{\"value\":\"Microsoft Office 365\"}}},{\"wildcard\":{\"okta.target.display_name\":{\"value\":\"GoDaddy SSO\"}}},{\"wildcard\":{\"okta.target.display_name\":{\"value\":\"Slack*\"}}},{\"wildcard\":{\"okta.target.display_name\":{\"value\":\"Okta Admin Console\"}}},{\"wildcard\":{\"okta.target.alternate_id\":{\"value\":\"Zoom Enterprise\"}}}],\"minimum_should_match\":1}}","key":"query"},"query":{"bool":{"should":[{"wildcard":{"okta.target.display_name":{"value":"Microsoft Office 365"}}},{"wildcard":{"okta.target.display_name":{"value":"GoDaddy SSO"}}},{"wildcard":{"okta.target.display_name":{"value":"Slack*"}}},{"wildcard":{"okta.target.display_name":{"value":"Okta Admin Console"}}},{"wildcard":{"okta.target.alternate_id":{"value":"Zoom Enterprise"}}}],"minimum_should_match":1}}},{"$state":{"store":"appState"},"meta":{"negate":true,"alias":null,"disabled":false,"type":"custom","value":"{\"bool\":{\"should\":[{\"match_phrase\":{\"okta.client.user_agent.raw_user_agent\":\"unknown\"}},{\"regexp\":{\"okta.client.user_agent.raw_user_agent\":\"Microsoft Office.*\"}},{\"regexp\":{\"okta.client.user_agent.raw_user_agent\":\"AppleExchangeWebServices.*\"}},{\"regexp\":{\"okta.client.user_agent.raw_user_agent\":\"Android-Mail.*\"}},{\"regexp\":{\"okta.client.user_agent.raw_user_agent\":\".*CalendarAgent.*\"}},{\"match_phrase\":{\"okta.client.user_agent.raw_user_agent\":\"Windows-AzureAD-Authentication-Provider/.*\"}},{\"regexp\":{\"okta.client.user_agent.raw_user_agent\":\"Okta Radius Agent.*\"}},{\"regexp\":{\"okta.client.user_agent.raw_user_agent\":\"PAN GlobalProtect.*\"}},{\"regexp\":{\"okta.client.user_agent.raw_user_agent\":\"Jamf%20Connect.*\"}},{\"regexp\":{\"okta.client.user_agent.raw_user_agent\":\"okta-auth-dotnet.*\"}},{\"regexp\":{\"okta.client.user_agent.raw_user_agent\":\"SecurityAgentHelper.*\"}}],\"minimum_should_match\":1}}","key":"query"},"query":{"bool":{"should":[{"match_phrase":{"okta.client.user_agent.raw_user_agent":"unknown"}},{"regexp":{"okta.client.user_agent.raw_user_agent":"Microsoft Office.*"}},{"regexp":{"okta.client.user_agent.raw_user_agent":"AppleExchangeWebServices.*"}},{"regexp":{"okta.client.user_agent.raw_user_agent":"Android-Mail.*"}},{"regexp":{"okta.client.user_agent.raw_user_agent":".*CalendarAgent.*"}},{"match_phrase":{"okta.client.user_agent.raw_user_agent":"Windows-AzureAD-Authentication-Provider/.*"}},{"regexp":{"okta.client.user_agent.raw_user_agent":"Okta Radius Agent.*"}},{"regexp":{"okta.client.user_agent.raw_user_agent":"PAN GlobalProtect.*"}},{"regexp":{"okta.client.user_agent.raw_user_agent":"Jamf%20Connect.*"}},{"regexp":{"okta.client.user_agent.raw_user_agent":"okta-auth-dotnet.*"}},{"regexp":{"okta.client.user_agent.raw_user_agent":"SecurityAgentHelper.*"}}],"minimum_should_match":1}}},{"$state":{"store":"appState"},"meta":{"field":"client.ip","negate":true,"alias":null,"disabled":false,"params":{"lt":"132.148.54.255","gte":"132.148.54.0"},"type":"range","key":"client.ip"},"query":{"range":{"client.ip":{"lt":"132.148.54.255","gte":"132.148.54.0"}}}},{"$state":{"store":"appState"},"meta":{"field":"client.ip","negate":true,"alias":null,"disabled":false,"params":{"lt":"64.202.160.255","gte":"64.202.160.0"},"type":"range","key":"client.ip"},"query":{"range":{"client.ip":{"lt":"64.202.160.255","gte":"64.202.160.0"}}}},{"$state":{"store":"appState"},"meta":{"negate":true,"alias":null,"disabled":false,"type":"phrases","params":["50.116.41.217","198.58.111.80","192.81.129.227","139.162.220.143"],"key":"client.ip"},"query":{"bool":{"should":[{"match_phrase":{"client.ip":"50.116.41.217"}},{"match_phrase":{"client.ip":"198.58.111.80"}},{"match_phrase":{"client.ip":"192.81.129.227"}},{"match_phrase":{"client.ip":"139.162.220.143"}}],"minimum_should_match":1}}},{"$state":{"store":"appState"},"meta":{"negate":false,"alias":null,"disabled":false,"type":"exists","value":"exists","key":"client.ip"},"query":{"exists":{"field":"client.ip"}}}],"threshold":{"field":["okta.actor.alternate_id"],"value":51,"cardinality":[]},"throttle":"rule","actions":[{"group":"default","id":"56fd1b40-5f85-11ec-9d1e-5b56ec0d9762","params":{"body":"{\n  \"short_description\": \"Elastic Test - Okta - Brute Force\",\n  \"assignment_group\": \"OPS-GCSO\",\n  \"category\": \"Unauthorized access\",\n  \"contact_type\": \"siem\",\n  \"description\": \"See attached info:\\n{{#context.alerts}}\\nokta.actor.alternate_id : {{okta.actor.alternate_id}}\\n@timestamp : {{signal.original_time}}\\nsource.ip  : {{source.ip}}\\nuser_agent.original  : {{user_agent.original}}\\nAttempts  : {{context.value.condition0}}\\nDistinctIPAddresses  : pending addition to Elastic\\nDistinctUserAgents : pending addition to Elastic\\n{{/context.alerts}}\",\n  \"priority\": \"5\",\n  \"severity\": \"3\",\n  \"state\": \"10\"\n}"},"action_type_id":".webhook"},{"group":"default","id":"elastic-cloud-email","params":{"message":"The alert condition for '{{context.rule.name}}' was triggered.\n\nLink to results: {{context.results_link}}","to":["twhipple1@godaddy.com"],"subject":"Elastic Alert: {{context.rule.name}}"},"action_type_id":".email"}]}
