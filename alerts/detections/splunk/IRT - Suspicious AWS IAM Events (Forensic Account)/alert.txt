"search index=""aws_cloudtrail"" (aws_account_id=197818030129 OR aws_account_id=883229650331 OR aws_account_id=332047608640) (app=""iam.amazonaws.com"" (eventName=Add* OR eventName=Change* OR eventName=Create* OR eventName=Deactivate* OR eventName=Delete* OR eventName=Enable* OR eventName=Pass* OR eventName=Remove* OR eventName=Reset* OR eventName=Resync* OR eventName=SetSecurity* OR eventName=Update* OR eventName=Upload*)) NOT ((userName=GD-AWS-IAM-Resources-GDAWSServiceAccountDeployRole-* AND sourceIPAddress = cloudformation.amazonaws.com) OR (userName = AWSServiceRoleForTrustedAdvisor AND sourceIPAddress = trustedadvisor.amazonaws.com) OR (userName = ServiceCatalogLaunchConstraintRole AND sourceIPAddress = servicecatalog.amazonaws.com) OR (userName = AccountAutomationServiceRole AND sourceIPAddress = cloudformation.amazonaws.com) OR userName=SC-*-pp-*-LambdaExecutionRole-* OR userName=GD-AWS-IAM-Resources-GDAWSServiceAccountDeployRole-*)
| fillnull value=""-""
| rename errorCode as Status, environment as Environment, aws_account_id as AccountID, eventName as Event, userName as User, principalUser as PrincipalUser,sourceIPAddress as SourceIP
| stats count by Status, Environment, AccountID, User, PrincipalUser, Event, SourceIP
| sort by Environment, User"